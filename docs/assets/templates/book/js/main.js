/*! avoncatalog v1.0.0 | ISC License | https://github.com/avon-world/avoncatalog#readme */
(function(a){var b=null,c=document.location.origin+"/docs/",d=function(b,c){var d=this,e=a('<div class="book initializing">'+'<div class="book-wrapper">'+'<div class="turn"></div>'+"</div>"+'<div class="book-slider turnjs-slider">'+'<div class="jsslider"></div>'+"</div>"+"</div>");d.element=b;d.turn=a(".turn",e);d.slider=a(".jsslider",e);d.index=-1;d.pageWidth=d.pageHeight=0;d.pages=[];d.page=0;d.book={};d.jsTurn=null;d._thumbPreview=null;d.select=a(c.select);d.data=c;a(b).append([d.select,e]);d.bookwrapper=e;a(b).data({data:d});d.select.data({data:d});d.init()};a.extend(d.prototype,{init:function(){var b=this;b.select.on("change",b.change.bind(b));a(window).on("resize",b.windowresize.bind(b));a(b.element).on("click",".zoom-img",b.fancyBoxPage)},loadPage:function(){var c=a(this),d=c.attr("data-page"),e=b.jsTurn.data(),f=e.pageObjs[d];f.removeClass("preloader");a(".preloader, .imghide",f).removeClass("preloader imghide");c.css({opacity:1})},loadThumb:function(){var b=this,c=a("img",b._thumbPreview);if(b._thumbPreview){setTimeout(function(){c.show();var d=a(b._thumbPreview).parent().outerWidth(),e=-(a(b._thumbPreview).outerWidth()-d)/2,f=parseInt(a(b._thumbPreview).css("min-width")),g=c.width(),h=Math.max(f,g);a(b._thumbPreview).css({"min-width":h+"px"});a(b._thumbPreview).css({left:e})},200)}},fancyBoxPage:function(b){b.preventDefault();var c=a(this),d=c.parent(),e=a("img",d),f=e.attr("src"),g={src:f,opts:{caption:e.attr("alt"),thumb:e.attr("data-thumb")}};if(f){a.fancybox.open([g])}return!1},sliderThumbnail:function(b){var c=this;console.log(b);if(c._thumbPreview){var d=c.pages[b-1].thumb,e=a(c._thumbPreview),f=e.children(":first"),g=(f.outerWidth(),-(e.outerWidth()-e.parent().outerWidth())/2),h=a("img",c._thumbPreview);e.addClass("no-transition").css({left:g});f.css({position:"relative"}).attr({"data-page":b});if(!h.length){h=a("<img />").addClass("img-responsive thumbnail-catalog");f.empty().append(h)}h[0].onload=h[0].onerror=c.loadThumb.bind(c);h[0].src=d;if(""===f.css("background-image")||"none"==f.css("background-image")){f.css({});setTimeout(function(){e.removeClass("no-transition").css({left:g})},0)}setTimeout(function(){e.removeClass("no-transition").css({left:g})},200)}},missing:function(b,c){var d=this,e=d.jsTurn;c.forEach(function(b,c,f){if(e.turn("pages"),!e.turn("hasPage",b)){var g=d.pages[b-1].image,h=d.pages[b-1].thumb,i="Страница №"+b,j=a("<div />",{class:"divshadow preloader"}),k=a("<span />",{class:"zoom-img icon-zoom-in"}),l=a(new Image).attr({class:"img-responsive imghide","data-page":b,alt:i,"data-thumb":h}),m=a("<div />",{class:"own-size preloader"});var n=new Image;n.src=h;m.append([j,l,k]);e.turn("addPage",m,b);setTimeout(function(){var a=l[0];a.onload=d.loadPage.bind(a);a.onerror=d.loadPage.bind(a);a.src=g},50)}})},change:function(b){var c=this,d=c.select,e=parseInt(d.val());if(c.index!=e){c.index=e;c.book=c.data.catalogs[c.index];c.pages=c.data.catalogs[c.index].pages;c.pageWidth=c.pages[0].width;c.pageHeight=c.pages[0].height;c.bookwrapper.addClass("initializing");setTimeout(function(){if(c.jsTurn){c.jsTurn.turn("destroy");c.slider.slider("destroy");a(".thumbnail",c.slider).remove()}c._thumbPreview=null;a("*",c.turn).unbind();c.turn.empty();c.page=1;c.jsTurn=a('<div class="sj-book"></div>');c.turn.append(c.jsTurn);setTimeout(function(){c.initTurn();a([c.element,c.jsTurn[0],d[0]]).data({data:c})},700)},300)}},initTurn:function(){var b=this,c=a(".turn",b.element).outerWidth()-60,d=c,e=c/(2*b.pageWidth)*b.pageHeight,f=b.pages[0].width<b.pages[0].height?"double":"single";b.slider.slider({min:1,max:b.pages.length,start:function(c,d){if(b._thumbPreview){b.sliderThumbnail(d.value)}else{b._thumbPreview=a("<div />",{class:"thumbnail"}).html("<div></div>");b.sliderThumbnail(d.value);b._thumbPreview.appendTo(a(d.handle))}},slide:function(a,c){b.sliderThumbnail(c.value)},stop:function(){if(b._thumbPreview){b._thumbPreview.removeClass("show");b.jsTurn.turn("page",Math.max(1,a(this).slider("value")))}}});b.jsTurn.css({}).turn({elevation:50,acceleration:false,autoCenter:true,gradients:true,duration:800,pages:b.pages.length,width:d,height:e,page:b.page,display:"double",when:{turning:function(b,c,d){var e=a(this),f=e.turn("page"),g=e.turn("pages");if(f>3&&g-3>f){if(1==c){return e.turn("page",2).turn("stop").turn("page",c)}if(c==g){return e.turn("page",g-1).turn("stop").turn("page",c)}}else if(c>3&&g-3>c){if(1==f){return e.turn("page",2).turn("stop").turn("page",c)}if(f==g){return e.turn("page",g-1).turn("stop").turn("page",c)}}e.turn("page");e.turn("pages")},turned:function(c,d,e){var f=a(this),g={};b.page=parseInt(d||f.turn("page"),10);var h=b.page,i=b.page%2,j=b.pages.length;b.slider.slider("value",h);g={double:!(1==h||h==b.pages.length),start:0==i?h==j?j:h:h==j?j:1==h?h:h-1};b.getProducts(g)},missing:b.missing.bind(b),start:function(a,b){}}});b.bookwrapper.removeClass("initializing")},getProducts:function(b){var d=this,e=b.double,f=b.start,g=d.pages[f-1].products.slice(),h=[],i=[],j=e?d.pages[f].products.slice():[],k=[],l=[],m=function(b,e){if(b.length&&parseInt(e)){var f={modal:b.join(","),page:parseInt(e),compaing:d.data.compaing,index:d.index+1};a.ajax({url:c+"function.php",data:f,method:"POST",type:"json",success:n,error:function(){n(null)}})}},n=function(a){if(a){}if(e){e=false;if(l.length){m(l,f+1)}}};g.forEach(function(a,b,c){h.push(a.ProductId)});j.forEach(function(a,b,c){k.push(a.ProductId)});i=d.filterArray(h);l=d.filterArray(k);if(i.length){m(i,f)}else{e=false;m(l.length,f+1)}},filterArray:function(a){var b=a.slice(),c=b.filter(function(a,c){return b.indexOf(a)==c});return c},windowresize:function(b){var c=this,d=a(c.element);if(-1!=c.page&&c.jsTurn){c.jsTurn.turn("destroy");c.initTurn()}}});var e=function(c){b=new d(a(".avoncatalog")[0],c)};a.ajax({url:c+"function.php?catalog",method:"GET",type:"json",success:e})})(jQuery);